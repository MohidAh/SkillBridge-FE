<div class="step-container">
  <div class="step-header">
    <div class="step-icon-badge">üéì</div>
    <h2 class="step-title">Academic Information</h2>
    <p class="step-desc">Add all your academic qualifications ‚Äî you can add multiple degrees</p>
  </div>

  <div class="degree-section">
    <!-- ‚îÄ‚îÄ Saved degree cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (degrees.length > 0) {
      <div class="degrees-list">
        @for (deg of degrees; track deg; let i = $index) {
          <div class="degree-card">
            <div class="degree-card__icon">üèõÔ∏è</div>
            <div class="degree-card__body">
              <span class="degree-card__program">{{ deg.degree }}</span>
              <span class="degree-card__institution">{{ deg.institution }}</span>
              <div class="degree-card__meta">
                <span class="degree-card__tag">{{ deg.major }}</span>
                <span class="degree-card__tag">
                  {{ deg.startYear }} ‚Äì {{ deg.endYear || 'In Progress' }}
                </span>
                @if (deg.degreeFileUrl) {
                  <span class="degree-card__tag degree-card__tag--file">
                    <mat-icon style="font-size: 13px; width: 13px; height: 13px">
                      attach_file
                    </mat-icon>
                    {{ deg.degreeFileUrl }}
                  </span>
                }
              </div>
            </div>
            <div class="degree-card__actions">
              <button type="button" class="degree-icon-btn" (click)="editDegree(i)" title="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button
                type="button"
                class="degree-icon-btn degree-icon-btn--remove"
                (click)="removeDegree(i)"
                title="Remove"
              >
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>
        }
      </div>
    }

    <!-- ‚îÄ‚îÄ "Add Another" button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (!showDegreeForm && degrees.length > 0) {
      <button type="button" class="add-degree-btn" (click)="openAddDegree()">
        <mat-icon>add_circle_outline</mat-icon>
        Add Another Degree
      </button>
    }

    <!-- ‚îÄ‚îÄ Inline degree form ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (showDegreeForm) {
      <div class="degree-form-panel">
        <div class="degree-form-panel__header">
          <mat-icon>school</mat-icon>
          <span>
            {{
              editingIndex >= 0
                ? 'Edit Degree'
                : degrees.length > 0
                  ? 'Add Another Degree'
                  : 'Degree Details'
            }}
          </span>
        </div>

        <form [formGroup]="degreeForm" class="step-form" style="gap: 6px">
          <!-- Institution + Degree Type -->
          <div class="form-row">
            <mat-form-field appearance="outline" class="step-field">
              <mat-label>Institution / University</mat-label>
              <input matInput formControlName="institution" placeholder="e.g. FAST-NUCES Karachi" />
              @if (
                degreeForm.get('institution')?.invalid && degreeForm.get('institution')?.touched
              ) {
                <mat-error>Required</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-row two-cols">
            <mat-form-field appearance="outline" class="step-field">
              <mat-label>Degree</mat-label>
              <mat-select formControlName="degree">
                @for (d of degreeTypes; track d) {
                  <mat-option [value]="d">{{ d }}</mat-option>
                }
              </mat-select>
              @if (degreeForm.get('degree')?.invalid && degreeForm.get('degree')?.touched) {
                <mat-error>Required</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="step-field">
              <mat-label>Major / Field of Study</mat-label>
              <input matInput formControlName="major" placeholder="e.g. Computer Science" />
              @if (degreeForm.get('major')?.invalid && degreeForm.get('major')?.touched) {
                <mat-error>Required</mat-error>
              }
            </mat-form-field>
          </div>

          <!-- Start Year + End Year -->
          <div class="form-row two-cols">
            <mat-form-field appearance="outline" class="step-field">
              <mat-label>Start Year</mat-label>
              <mat-select formControlName="startYear">
                @for (y of years; track y) {
                  <mat-option [value]="y">{{ y }}</mat-option>
                }
              </mat-select>
              @if (degreeForm.get('startYear')?.invalid && degreeForm.get('startYear')?.touched) {
                <mat-error>Required</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="step-field">
              <mat-label>
                End Year
                <span class="field-hint">(leave blank = In Progress)</span>
              </mat-label>
              <mat-select formControlName="endYear">
                <mat-option value="">In Progress</mat-option>
                @for (y of years; track y) {
                  <mat-option [value]="y">{{ y }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Degree Upload -->
          <div class="form-row">
            <label class="field-label">
              Degree Certificate
              <span class="field-hint">(optional)</span>
            </label>
            <input
              #fileInput
              type="file"
              accept=".pdf,.jpg,.jpeg,.png"
              class="file-input-hidden"
              (change)="onFileSelected($event)"
            />
            <div class="file-upload-area" (click)="triggerFileInput(fileInput)">
              @if (selectedFile) {
                <mat-icon class="file-upload-area__icon file-upload-area__icon--ok">
                  check_circle
                </mat-icon>
                <span class="file-upload-area__name">{{ selectedFile.name }}</span>
              } @else {
                <mat-icon class="file-upload-area__icon">upload_file</mat-icon>
                <span class="file-upload-area__text">Click to upload PDF, JPG or PNG</span>
              }
            </div>
          </div>

          <!-- Form actions -->
          <div class="degree-form-actions">
            @if (degrees.length > 0 || editingIndex >= 0) {
              <button type="button" class="btn-cancel" (click)="cancelDegreeForm()">Cancel</button>
            }
            <button type="button" class="btn-add-degree" (click)="saveDegree()">
              <mat-icon>check</mat-icon>
              Save Degree
            </button>
          </div>
        </form>
      </div>
    }
  </div>

  <!-- Step navigation -->
  <div class="step-actions">
    <button type="button" matButton class="btn-back" (click)="back.emit()">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
    <button
      type="button"
      matButton="filled"
      class="btn-next"
      [disabled]="degrees.length === 0 && degreeForm.invalid"
      (click)="submit()"
    >
      Continue
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>
</div>
