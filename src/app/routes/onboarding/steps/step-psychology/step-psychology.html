<div class="step-container">
  <div class="step-header">
    <div class="step-icon-badge">ðŸ§ </div>
    <h2 class="step-title">Personality Assessment</h2>
    <p class="step-desc">
      Rate how well each statement describes you on a scale of 1 (Not at all) to 5 (Very much)
    </p>
  </div>

  @if (!showResults) {
    <!-- Progress -->
    <div class="assessment-progress">
      <div class="assessment-progress__bar">
        <div class="assessment-progress__fill" [style.width.%]="progress"></div>
      </div>
      <span class="assessment-progress__label">
        {{ answeredCount }} / {{ questions.length }} answered
      </span>
    </div>

    <!-- Questions -->
    <div class="questions-list">
      @for (q of questions; track q.id; let i = $index) {
        <div class="question-card" [class.question-card--answered]="answers[q.id]">
          <div class="question-card__num">{{ i + 1 }}</div>
          <div class="question-card__body">
            <p class="question-card__text">{{ q.text }}</p>
            <div class="likert-scale">
              <span class="likert-scale__label">Not at all</span>
              <div class="likert-scale__options">
                @for (val of [1, 2, 3, 4, 5]; track val) {
                  <button
                    type="button"
                    class="likert-btn"
                    [class.likert-btn--selected]="answers[q.id] === val"
                    (click)="setAnswer(q.id, val)"
                  >
                    {{ val }}
                  </button>
                }
              </div>
              <span class="likert-scale__label">Very much</span>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Actions -->
    <div class="step-actions">
      <button type="button" matButton class="btn-back" (click)="back.emit()">
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>
      <button
        type="button"
        matButton="filled"
        class="btn-next"
        [disabled]="!allAnswered"
        (click)="calculate()"
      >
        View Results
        <mat-icon>insights</mat-icon>
      </button>
    </div>
  } @else {
    <!-- Results -->
    <div class="results-container">
      <div class="results-header">
        <span class="results-emoji">ðŸŽ‰</span>
        <h3 class="results-title">Your Personality Profile</h3>
        <p class="results-desc">Here's how your Big Five traits scored</p>
      </div>

      <div class="trait-bars">
        @for (trait of traits; track trait) {
          <div class="trait-row">
            <div class="trait-row__meta">
              <span class="trait-row__icon">{{ traitMeta[trait].icon }}</span>
              <div>
                <span class="trait-row__name">{{ traitMeta[trait].label }}</span>
                <span class="trait-row__desc">{{ traitMeta[trait].desc }}</span>
              </div>
            </div>
            <div class="trait-bar-wrap">
              <div class="trait-bar">
                <div class="trait-bar__fill" [style.width.%]="traitScores[trait]"></div>
              </div>
              <span class="trait-bar__score">{{ traitScores[trait] }}%</span>
            </div>
          </div>
        }
      </div>

      <div class="step-actions">
        <button type="button" matButton class="btn-back" (click)="showResults = false">
          <mat-icon>arrow_back</mat-icon>
          Retake
        </button>
        <button type="button" matButton="filled" class="btn-next btn-finish" (click)="submit()">
          Finish Setup
          <mat-icon>check_circle</mat-icon>
        </button>
      </div>
    </div>
  }
</div>
